<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Aion Ascend — Schedule, Upcoming, Timer & Checklists</title>
<style>
  :root{
    --bg: #0f172a;
    --card: #111827;
    --muted: #94a3b8;
    --text: #e5e7eb;
    --border: #1f2937;
    --accent: #22d3ee;

    --cat-battlegrounds: #2563eb;
    --cat-short: #eab308;
    --cat-siege: #ef4444;
    --cat-raid: #10b981;
    --now-bg: linear-gradient(180deg,#6ee7b7,#34d399);
    --now-outline: #10b981;
    --next-bg: linear-gradient(180deg,#fbbf24,#f59e0b);
    --next-outline: #f59e0b;

    --timer-green: #10b981;
    --timer-orange: #f59e0b;
    --timer-red: #ef4444;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:linear-gradient(180deg,#0b1224,#0f172a 30%,#0b1224);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue','Noto Sans',sans-serif}
  a{color:inherit}
  .wrap{max-width:1200px;margin:32px auto;padding:0 20px}
  header{
    display:flex;align-items:center;justify-content:space-between;gap:16px;
    border:1px solid var(--border);background:linear-gradient(180deg,#0b1224,#0f172a);
    padding:18px 20px;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.05);
    position:sticky;top:12px;z-index:10;backdrop-filter: blur(6px);
  }
  h1{font-size:clamp(22px,3vw,28px);margin:0;font-weight:800;letter-spacing:.3px}
  .tz{font-weight:600;color:#94a3b8;font-size:14px}
  .section-title{margin:26px 4px 12px;font-size:20px;font-weight:700;color:#cbd5e1;letter-spacing:.2px}

  /* Weekly grid */
  .grid{display:grid;gap:18px;grid-template-columns:repeat(7,minmax(120px,1fr))}
  .day{border:1px solid var(--border);border-radius:16px;overflow:hidden;background:linear-gradient(180deg,#0f172a,#0b1224);box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .day h3{margin:0;padding:12px 14px;font-size:16px;letter-spacing:.3px;border-bottom:1px solid var(--border);background:#0b1224}
  .list{padding:12px;display:flex;flex-direction:column;gap:10px}
  .row{border:1px solid var(--border);background:#0f172a;border-radius:12px;padding:12px 12px}
  .r-name{display:block;font-weight:800;font-size:15px;margin-bottom:6px;line-height:1.2}
  .r-time{display:inline-block;font-weight:900;font-size:14px;letter-spacing:.2px;color:#0b1224;background:linear-gradient(180deg,#e5e7eb,#cbd5e1); padding:4px 8px; border-radius:8px;font-variant-numeric:tabular-nums}
  .r-time.now{background:linear-gradient(180deg,#6ee7b7,#34d399); color:#052e1c; outline:2px solid var(--timer-green)}
  .r-time.next{background:linear-gradient(180deg,#fbbf24,#f59e0b); color:#3b1a01; outline:2px solid var(--timer-orange)}

  footer{margin:26px 4px;color:#94a3b8;font-size:12px}
  @media (max-width: 980px){ .grid{grid-template-columns:repeat(2,1fr)} }
  @media (max-width: 640px){ .grid{grid-template-columns:1fr} }

  /* Timer */
  .timer{border:1px solid var(--border);background:linear-gradient(180deg,#0f172a,#0b1224);padding:18px;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);display:grid;grid-template-columns:1fr;gap:14px}
  .timer-top{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
  .timer label{font-weight:700;color:#cbd5e1}
  .timer input[type="number"]{width:110px;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b1224;color:#var(--text);font-weight:800}
  .btn{appearance:none;border:1px solid var(--border);background:#0f172a;color:#e5e7eb;font-weight:800;padding:10px 14px;border-radius:12px;cursor:pointer;transition:transform .05s ease}
  .btn:hover{transform:translateY(-1px)}
  .btn.green{background:linear-gradient(180deg,#34d399,#10b981);color:#052e1c}
  .btn.orange{background:linear-gradient(180deg,#fbbf24,#f59e0b);color:#3b1a01}
  .btn.ghost{background:#0f172a;color:#e5e7eb}
  .presets{display:flex;gap:8px;flex-wrap:wrap}
  .timer-display{display:flex;align-items:baseline;gap:16px;flex-wrap:wrap}
  .digits{
    font-variant-numeric:tabular-nums; font-weight:900; letter-spacing:.5px;
    font-size: clamp(36px, 7vw, 64px);
    background: radial-gradient(800px 200px at 0% 0%, rgba(255,255,255,.06), transparent 50%), linear-gradient(180deg, #0f172a, #0b1224);
    border:1px solid var(--border); padding:14px 18px; border-radius:16px;
  }
  .digits.state-green{background:linear-gradient(180deg,#6ee7b7,#34d399); color:#052e1c; outline:2px solid var(--timer-green)}
  .digits.state-orange{background:linear-gradient(180deg,#fbbf24,#f59e0b); color:#3b1a01; outline:2px solid var(--timer-orange)}
  .digits.state-red{background:linear-gradient(180deg,#fecaca,#f87171); color:#220002; outline:2px solid var(--timer-red)}
  .progress{position:relative;height:10px;background:#0b1224;border:1px solid var(--border);border-radius:999px;overflow:hidden;flex:1;min-width:200px}
  .bar{position:absolute;left:0;top:0;bottom:0;width:0%}
  .bar.green{background:linear-gradient(90deg,#22d3ee,#10b981)}
  .bar.orange{background:linear-gradient(90deg,#f59e0b,#efb72a)}
  .bar.red{background:linear-gradient(90deg,#ef4444,#f87171)}

  /* Checklists */
  .reset-row-global{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 18px}
  .checklists{display:grid;grid-template-columns:1fr 1fr;gap:18px}
  @media (max-width: 880px){ .checklists{grid-template-columns:1fr} }
  .check-card{border:1px solid var(--border);background:linear-gradient(180deg,#0f172a,#0b1224);padding:18px;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .group{margin-top:6px}
  .group-title{
    margin:8px 0 8px;
    font-size:15px;font-weight:900;letter-spacing:.3px;
    color:#7dd3fc;
    background:rgba(34,211,238,0.08);
    border:1px solid var(--border);
    padding:6px 10px;border-radius:10px;
  }
  .item{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:8px 0;border-top:1px dashed #1e293b}
  .item:first-child{border-top:0}
  .item-name{font-weight:700}
  .ticks{display:flex;gap:10px;flex-wrap:wrap}
  .tickbox{width:22px;height:22px;accent-color:#10b981;cursor:pointer}
  .item.done .item-name{opacity:.65;text-decoration:line-through}
  .spacer-row{height:18px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Ascend Weekly Schedule</h1>
      <div class="tz" id="tz"></div>
    </header>

    <div class="section-title">This week</div>
    <div class="grid" id="grid"></div>

    <div class="section-title">Custom countdown</div>
    <div class="timer" id="timer">
      <div class="timer-top">
        <label for="seconds">Length (sec):</label>
        <input id="seconds" type="number" min="1" step="1" value="45" style="color:#fff;" />
        <div class="presets">
          <button class="btn ghost" data-preset="15">15s</button>
          <button class="btn ghost" data-preset="30">30s</button>
          <button class="btn ghost" data-preset="45">45s</button>
          <button class="btn ghost" data-preset="60">60s</button>
        </div>
        <div class="switch" style="margin-left:auto;display:flex;align-items:center;gap:8px">
          <input id="loop" type="checkbox" checked />
          <label for="loop">Auto‑restart</label>
        </div>
      </div>
      <div class="timer-display">
        <div class="digits" id="digits" aria-live="polite">00:45</div>
        <div class="progress"><div class="bar green" id="bar"></div></div>
        <div class="cycles">Cycle: <span id="cycle">1</span></div>
      </div>
      <div class="timer-actions" style="display:flex; gap:8px; flex-wrap:wrap">
        <button id="start" class="btn green">Start</button>
        <button id="pause" class="btn orange">Pause</button>
        <button id="reset" class="btn">Reset</button>
      </div>
    </div>

    <div class="section-title">Daily & Weekly Checklists</div>
    <div class="reset-row-global">
      <button class="btn" id="resetDaily">Reset dailies</button>
      <button class="btn" id="resetWeekly">Reset weeklies</button>
    </div>
    <div class="checklists">
      <div class="check-card" id="leftCol">
        <!-- Left: Daily Battlefield (Scheduled), Weekly DG, Daily DG -->
      </div>
      <div class="check-card" id="rightCol">
        <!-- Right: Daily Quests, Weekly Quests -->
      </div>
    </div>

    <footer>Times are shown in your device's local time.</footer>
  </div>

<script>
// ------------------- Schedule data (Monday = 0 .. Sunday = 6) -------------------
const SCHEDULE = [
  { name: "Chantra Dredgion", category: "Battlegrounds", days: [0,1,2,3,4,5,6], start: "11:00", end: "13:00" },
  { name: "Chantra Dredgion", category: "Battlegrounds", days: [0,1,2,3,4,5,6], start: "22:00", end: "24:00" },
  { name: "Tiak Research Center", category: "Battlegrounds", days: [1,2,4], start: "20:00", end: "22:00" },
  { name: "Black Vevium Battlefield", category: "Battlegrounds", days: [0,2,4], start: "21:00", end: "23:00" },
  { name: "Harbinger of Fate", category: "Battlegrounds", days: [0,1,2,3,4,5,6], start: "10:00", end: "10:30" },
  { name: "Harbinger of Fate", category: "Battlegrounds", days: [0,1,3,4,5], start: "20:00", end: "20:30" },
  { name: "Incarnate Conquests", category: "Short Event", days: [0,1,2,3,4,5,6], start: "18:00", end: "18:15" },
  { name: "Temple of Scales & Crimson Temple", category: "Siege", days: [1], start: "19:00", end: "20:00" },
  { name: "Temple of Scales & Crimson Temple", category: "Siege", days: [6], start: "16:00", end: "17:00" },
  { name: "Altar of Avarice & Vorgaltem Citadel", category: "Siege", days: [3], start: "19:00", end: "20:00" },
  { name: "Altar of Avarice & Vorgaltem Citadel", category: "Siege", days: [6], start: "16:00", end: "17:00" },
  { name: "Alpheta Beluslan", category: "Siege", days: [2,5], start: "19:00", end: "20:00" },
  { name: "Governor Sunayaka", category: "Raid", days: [4,5], start: "20:00", end: "21:00" },
  { name: "Hexad", category: "Raid", days: [2,6], start: "20:00", end: "21:00" },
  { name: "Dredgion Interception", category: "Raid", days: [1,3], start: "20:00", end: "21:00" },
  { name: "Eye rift", category: "Special Event", days: [0,5,6], start: "19:00", end: "19:30" } // Added Eye rift event
];
const DAY_NAMES = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];

// ------------------- Helpers for schedule -------------------
function parseHM(hm){ const [h,m] = hm.split(":").map(Number); return {h,m}; }
function toLocaleHM(d){ return d.toLocaleTimeString([], { hour: "numeric", minute: "2-digit" }); }
function toDateForDowAndTime(now, mondayIndex, hm){
  const targetJs = (mondayIndex + 1) % 7;
  const {h,m} = parseHM(hm);
  const todayJs = now.getDay();
  let add = (targetJs - todayJs + 7) % 7;
  const candidate = new Date(now);
  candidate.setHours(0,0,0,0);
  candidate.setDate(candidate.getDate() + add);
  candidate.setHours(h, m, 0, 0);
  return candidate;
}
function endDateFromStart(start, startHM, endHM){
  const e = parseHM(endHM);
  const end = new Date(start);
  if(endHM === "24:00"){ end.setDate(end.getDate() + 1); end.setHours(0,0,0,0); }
  else{ end.setHours(e.h, e.m, 0, 0); if(end <= start){ end.setDate(end.getDate() + 1); } }
  return end;
}
function nextOccurrences(now){
  const occ = [];
  for(const ev of SCHEDULE){
    for(const d of ev.days){
      const start = toDateForDowAndTime(now, d, ev.start);
      const end = endDateFromStart(start, ev.start, ev.end);
      if(now > end){ start.setDate(start.getDate() + 7); }
      const nextEnd = endDateFromStart(start, ev.start, ev.end);
      const ongoing = now >= start && now < nextEnd;
      occ.push({ ...ev, dayIndex: d, start, end: nextEnd, ongoing });
    }
  }
  occ.sort((a,b)=> a.start - b.start);
  return occ;
}
function groupByDayWithLocalTimes(now){
  const map = Array.from({length:7}, (_,i)=>({ day:i, events:[] }));
  for(const ev of SCHEDULE){
    for(const d of ev.days){
      const start = toDateForDowAndTime(now, d, ev.start);
      const end = endDateFromStart(start, ev.start, ev.end);
      map[d].events.push({ name: ev.name, start, end, dayIndex: d });
    }
  }
  // Sort events by start time, and if start time is same, by end time (earlier first)
  for(const col of map){ 
    col.events.sort((a,b) => {
      if (a.start.getTime() === b.start.getTime()) {
        return a.end - b.end; // Earlier end times first
      }
      return a.start - b.start;
    });
  }
  return map;
}
function keyOf(ev){ return `${ev.name}|${ev.dayIndex}|${ev.start.toISOString()}`; }
function categoryClass(cat){
  const c = cat?.toLowerCase() || "";
  if(c.startsWith("battle")) return "battlegrounds";
  if(c.startsWith("short")) return "short";
  if(c.startsWith("siege")) return "siege";
  if(c.startsWith("raid")) return "raid";
  if(c.startsWith("special")) return "raid"; // Using raid color for special events
  return "";
}

// ------------------- Render schedule -------------------
function renderHeader(){
  const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || "local time";
  const now = new Date();
  const s = now.toLocaleTimeString([], { hour:"numeric", minute:"2-digit" });
  document.getElementById("tz").textContent = `Your time: ${s} · ${tz}`;
}

function renderGrid(){
  const grid = document.getElementById("grid");
  const now = new Date();
  const columns = groupByDayWithLocalTimes(now);

  const occ = nextOccurrences(now);
  
  // Find the next upcoming event (regardless of whether there's a current one)
  let nextEvent = null;
  for (const event of occ) {
    if (event.start > now) {
      nextEvent = event;
      break;
    }
  }
  
  // If we found a next event, find all events with the same start time
  let nextEvents = [];
  if (nextEvent) {
    const nextStartTime = nextEvent.start.getTime();
    nextEvents = occ.filter(o => o.start.getTime() === nextStartTime);
  }

  grid.innerHTML = columns.map(col=>{
    const dayTitle = DAY_NAMES[col.day];
    const rows = col.events.map(ev => {
      const when = `${toLocaleHM(ev.start)}–${toLocaleHM(ev.end)}`;
      const evKey = keyOf(ev);
      const live = now >= ev.start && now < ev.end;
      
      // Check if this event is one of the next events
      const isNext = nextEvents.some(ne => keyOf(ne) === evKey);
      
      const timeClass = live ? "now" : (isNext ? "next" : "");
      return `<div class="row">
          <span class="r-name">${ev.name}</span>
          <span class="r-time ${timeClass}">${when}</span>
        </div>`;
    }).join("");
    return `<div class="day">
      <h3>${dayTitle}</h3>
      <div class="list">${rows || '<div class="row"><span class="r-name">No events</span></div>'}</div>
    </div>`;
  }).join("");
}

// Initial render + refresh every minute
renderHeader();
renderGrid();
setInterval(()=>{ renderHeader(); renderGrid(); }, 60 * 1000);

// ------------------- Timer with color thresholds -------------------
(function initTimer(){
  const secondsInput = document.getElementById("seconds");
  const digits = document.getElementById("digits");
  const bar = document.getElementById("bar");
  const cycleEl = document.getElementById("cycle");
  const loopChk = document.getElementById("loop");
  const btnStart = document.getElementById("start");
  const btnPause = document.getElementById("pause");
  const btnReset = document.getElementById("reset");

  let durationMs = (+secondsInput.value || 45) * 1000;
  let remainingMs = durationMs;
  let running = false;
  let cycle = 1;
  let endAt = null;
  let tickHandle = null;

  function fmt(ms){
    ms = Math.max(0, ms|0);
    const s = Math.ceil(ms / 1000);
    const h = Math.floor(s / 3600);
    const m = Math.floor((s % 3600) / 60);
    const sec = s % 60;
    if(h > 0) return `${h}:${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
    return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
  }
  function setDigits(ms){
    digits.textContent = fmt(ms);
    const s = Math.ceil(Math.max(0, ms) / 1000);
    digits.classList.remove('state-green','state-orange','state-red');
    bar.classList.remove('green','orange','red');
    if(s > 20){ digits.classList.add('state-green'); bar.classList.add('green'); }
    else if(s >= 10){ digits.classList.add('state-orange'); bar.classList.add('orange'); }
    else { digits.classList.add('state-red'); bar.classList.add('red'); }
  }
  function setProgress(ms){
    const pct = 100 * (1 - (ms / durationMs));
    bar.style.width = `${Math.min(100, Math.max(0, pct))}%`;
  }
  function update(){
    if(!running) return;
    const now = Date.now();
    remainingMs = endAt - now;
    if(remainingMs <= 0){
      if(loopChk.checked){
        cycle += 1; cycleEl.textContent = String(cycle);
        endAt = now + durationMs; remainingMs = durationMs;
      }else{
        remainingMs = 0; pause();
      }
    }
    setDigits(remainingMs); setProgress(remainingMs);
    requestAnimationFrame(update);
  }
  function pause(){
    running = false;
    if(tickHandle){ clearInterval(tickHandle); tickHandle = null; }
    btnStart.disabled = false;
  }

  // Controls
  document.querySelectorAll('[data-preset]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      secondsInput.value = btn.dataset.preset;
      secondsInput.dispatchEvent(new Event('change'));
    });
  });
  btnStart.addEventListener('click', ()=>{
    if(!running){
      if(remainingMs === 0 || remainingMs === durationMs){
        durationMs = Math.max(1, (+secondsInput.value||45)) * 1000;
        remainingMs = durationMs; cycle = 1; cycleEl.textContent = "1"; setProgress(remainingMs);
      }
      endAt = Date.now() + remainingMs; running = true; btnStart.disabled = true;
      if(tickHandle) clearInterval(tickHandle); tickHandle = setInterval(update, 200); update();
    }
  });
  btnPause.addEventListener('click', ()=>{ pause(); });
  btnReset.addEventListener('click', ()=>{
    pause(); durationMs = Math.max(1, (+secondsInput.value||45)) * 1000;
    remainingMs = durationMs; cycle = 1; cycleEl.textContent = "1"; setDigits(remainingMs); setProgress(remainingMs);
  });
  secondsInput.addEventListener('change', ()=>{
    const v = Math.max(1, (+secondsInput.value||45)); secondsInput.value = v; durationMs = v * 1000;
    if(!running){ remainingMs = durationMs; setDigits(remainingMs); setProgress(remainingMs); }
  });

  // init display
  setDigits(remainingMs); setProgress(remainingMs);
})();

// ------------------- Checklists -------------------
const KEY_PREFIX_DAILY = "ascend_daily_";
const KEY_PREFIX_WEEKLY = "ascend_weekly_";
function slug(s){ return s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }

// Groups organized EXACTLY as requested:
const LEFT_GROUPS = [
  { title: "Daily Battlefield (Scheduled)", scope: "daily", items: [
      { name: "Black Vevium Battlefield (4‑man)", attempts: 2 },
      { name: "Tiak (duo)", attempts: 2 },
      { name: "Dredge", attempts: 1 },
      { name: "Harbinger (solo)", attempts: 1 },
    ]},
  { title: "Weekly DG", scope: "weekly", items: [
	  { name: "Burning Citadel", attempts: 5 },
      { name: "Allos Cosmos", attempts: 5 },
      { name: "Wall of Lament", attempts: 4 },
      { name: "Phaistos", attempts: 1 },
    ]},
  { title: "Daily DG", scope: "daily", items: [
      { name: "Tempus (solo)", attempts: 1 },
      { name: "Labyrinth", attempts: 1 },
      { name: "Suna Dungeon", attempts: 1 },
    ]},
];

const RIGHT_GROUPS = [
  { title: "Daily Quests", scope: "daily", items: [
      { name: "Eye Quests", attempts: 1 },
	  { name: "Eye Reset Scrolls", attempts: 1 },
      { name: "Contracts", attempts: 1 },
      { name: "Mesa Sky", attempts: 1 },
    ]},
  { title: "Weekly Quests", scope: "weekly", items: [
      { name: "PVP Zones Tia", attempts: 1 },
      { name: "Lafsran quests", attempts: 1 },
	  { name: "Lafsran camps", attempts: 1 },
      { name: "Gelk/Ing Artis", attempts: 1 },
      { name: "Gelk/Ing PVP", attempts: 1 },
    ]},
];

function renderSide(containerId, groups){
  const root = document.getElementById(containerId);
  root.innerHTML = groups.map((group, idx) => {
    const prefix = group.scope === 'daily' ? KEY_PREFIX_DAILY : KEY_PREFIX_WEEKLY;
    const rows = group.items.map(it => {
      const ticks = Array.from({length: it.attempts}, (_,i)=>{
        const key = `${prefix}${slug(group.title)}__${slug(it.name)}__${i}`;
        const checked = localStorage.getItem(key) === '1' ? 'checked' : '';
        return `<input type="checkbox" class="tickbox" data-key="${key}" ${checked}>`;
      }).join("");
      const itemKey = `${prefix}${slug(group.title)}__${slug(it.name)}`;
      return `<div class="item" data-item="${itemKey}">
                <div class="item-name">${it.name}</div>
                <div class="ticks">${ticks}</div>
              </div>`;
    }).join("");
    const spacer = (idx < groups.length - 1) ? '<div class="spacer-row" aria-hidden="true"></div>' : '';
    return `<div class="group">
              <h4 class="group-title">${group.title}</h4>
              ${rows}
            </div>${spacer}`;
  }).join("");

  // Wire change events and set done state
  root.querySelectorAll('.tickbox').forEach(cb=>{
    const key = cb.dataset.key;
    cb.addEventListener('change', ()=>{
      localStorage.setItem(key, cb.checked ? '1' : '0');
      updateItemDone(cb.closest('.item'));
    });
  });
  root.querySelectorAll('.item').forEach(updateItemDone);
}

function updateItemDone(itemEl){
  const anyUnchecked = itemEl.querySelectorAll('.tickbox:not(:checked)').length > 0;
  itemEl.classList.toggle('done', !anyUnchecked);
}

function resetPrefix(prefix){
  Object.keys(localStorage).forEach(k=>{ if(k.startsWith(prefix)) localStorage.removeItem(k); });
  document.querySelectorAll(`.tickbox[data-key^="${prefix}"]`).forEach(cb=>{
    cb.checked = false;
    updateItemDone(cb.closest('.item'));
  });
}

// Render both sides
renderSide("leftCol", LEFT_GROUPS);
renderSide("rightCol", RIGHT_GROUPS);

// Reset buttons
document.getElementById('resetDaily').addEventListener('click', ()=> resetPrefix(KEY_PREFIX_DAILY));
document.getElementById('resetWeekly').addEventListener('click', ()=> resetPrefix(KEY_PREFIX_WEEKLY));
</script>
</body>
</html>